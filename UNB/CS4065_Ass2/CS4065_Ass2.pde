import de.voidplus.dollar.*;

OneDollar one;

int shapeID = 0; 
int moveX, moveY, dragX, dragY;
int strokeWeight = 5;
int red, green, blue; 
ArrayList<int[]> shapes = new ArrayList<int[]>();
ArrayList<PShape> freeShapes = new ArrayList<PShape>();
PShape free;
void setup() {
  surface.setTitle("CS4065 - Augmented Interactions - Assignment 2 (Conor & Eric)");
  size(1000, 600);
  textSize(28);
    
  // Create instance of class OneDollar:
  one = new OneDollar(this);
  println(one);                  // Print all the settings
  one.setVerbose(true);          // Activate console verbose
  one.setMinSimilarity(80);
  // Add gestures:
  one.learn("rectangle", new int[] {78,149,78,153,78,157,78,160,79,162,79,164,79,167,79,169,79,173,79,178,79,183,80,189,80,193,80,198,80,202,81,208,81,210,81,216,82,222,82,224,82,227,83,229,83,231,85,230,88,232,90,233,92,232,94,233,99,232,102,233,106,233,109,234,117,235,123,236,126,236,135,237,142,238,145,238,152,238,154,239,165,238,174,237,179,236,186,235,191,235,195,233,197,233,200,233,201,235,201,233,199,231,198,226,198,220,196,207,195,195,195,181,195,173,195,163,194,155,192,145,192,143,192,138,191,135,191,133,191,130,190,128,188,129,186,129,181,132,173,131,162,131,151,132,149,132,138,132,136,132,122,131,120,131,109,130,107,130,90,132,81,133,76,133} );
  one.learn("oval", new int[] {215,94,216,94,217,94,217,95,218,97,219,98,220,99,221,100,223,101,224,101,225,102,226,102,228,103,229,104,230,105,231,106,231,107,232,109,235,111,235,112,237,113,238,114,239,115,240,117,241,118,242,119,243,120,243,121,244,124,245,124,246,125,248,127,249,129,250,130,251,131,252,133,252,135,253,137,254,139,254,141,254,142,254,143,254,144,254,146,254,147,254,148,254,149,254,151,254,152,253,153,251,154,250,155,249,156,246,157,246,158,243,159,239,160,237,160,235,160,233,160,231,160,229,160,227,161,224,161,222,162,220,162,217,162,215,162,213,163,211,163,209,163,207,163,206,163,205,163,204,163,203,163,202,163,201,163,199,163,197,163,196,163,194,163,194,162,193,161,192,161,191,161,189,159,188,159,187,158,186,158,185,158,184,157,183,156,182,156,181,155,180,154,180,153,180,151,179,151,178,149,176,147,176,145,175,141,174,140,174,138,174,136,173,134,172,133,172,132,172,130,171,129,171,127,171,125,171,123,171,121,171,119,171,117,171,115,171,113,171,111,172,109,172,107,173,105,174,103,174,102,175,102,175,101,176,100,177,99,177,98,178,97,179,96,180,96,181,96,182,96,183,96,185,96,186,96,188,96,189,96,191,96,192,96,194,96,196,96,197,96,199,96,200,96,202,96,203,96,204,96,205,96,206,96,208,96,210,97,211,97,212,98,213,99,214,99,215,100,216,101,217,102,218,103,219,103,219,104,221,105,222,106,222,107,222,108} );
  one.learn("freeform_line", new int[] {210,297,210,296,210,295,210,294,210,292,210,290,210,288,210,287,210,286,210,285,210,284,210,283,210,281,210,280,210,279,210,277,210,276,210,275,210,274,210,273,210,272,210,270,210,268,210,267,210,266,210,264,210,263,210,262,210,261,210,260,209,259,209,258,209,257,209,256,209,254,208,253,207,252,206,251,206,250,206,249,206,247,206,245,204,243,204,242,204,240,204,238,204,235,203,233,203,232,202,230,202,229,202,228,202,226,202,225,202,223,202,221,202,219,201,217,201,215,201,213,201,211,201,209,201,208,201,206,201,204,201,203,201,201,201,199,201,198,201,197,201,196,201,195,202,194,202,193,203,191,203,190,204,189,205,189,206,189,208,189,211,189,213,189,215,189,217,190,219,191,222,192,224,192,228,193,231,194,233,194,236,195,239,195,243,196,246,196,249,197,252,197,256,199,260,200,264,201,267,201,270,202,272,202,275,202,278,202,282,202,285,202,288,202,289,202,286,201,285,200,284,199,282,198,280,197,278,196,277,196,275,194,271,194,268,192,267,192,264,191,262,190,260,190,257,190,252,189,249,189,246,189,243,189,240,189,238,189,236,189,234,189,232,188,231,188,230,188,228,188,227,188,226,188,225,188,224,188,222,188,221,188,219,188,217,189,216,190,216,191,215,192,215,194,215,195,215,197,215,198,214,199,214,201,214,202,214,204,213,207,213,209,213,211,213,213,213,215,212,217,212,219,212,222,212,224,212,226,212,228,212,229,212,231,212,233,212,234,212,236,212,237,211,239,211,240,211,241,211,242,211,243,211,244,211,245,211,247,211,249,211,250,211,251,211,252,211,253,212,253,213,253,215,253,216,254,218,254,220,254,221,254,223,254,225,254,227,254,230,254,232,254,236,254,240,256,243,256,247,256,250,256,252,256,254,256,256,256,257,256,259,256,260,256,261,256});
  one.learn("straight_line", new int[] {68,222,70,220,73,218,75,217,77,215,80,213,82,212,84,210,87,209,89,208,92,206,95,204,101,201,106,198,112,194,118,191,124,187,127,186,132,183,138,181,141,180,146,178,154,173,159,171,161,170,166,167,168,167,171,166,174,164,177,162,180,160,182,158,183,156,181,154,178,153,171,153,164,153,160,153,150,154,147,155,141,157,137,158,135,158,137,158,140,157,143,156,151,154,160,152,170,149,179,147,185,145,192,144,196,144,198,144,200,144,201,147,199,149,194,157,191,160,186,167,180,176,177,179,171,187,169,189,165,194,164,196} );
  one.learn("black", new int[] {153,100,153,101,153,102,153,104,153,105,153,107,153,108,153,110,153,111,153,112,153,113,153,115,153,116,153,119,153,122,153,124,153,125,153,126,153,127,153,129,153,130,154,131,155,132,156,132,157,132,157,134,157,136,157,137,157,138,157,140,157,141,157,142,157,143,157,144,157,145,157,147,157,149,157,151,157,153,157,154,157,156,157,158,157,160,157,161,157,162,157,164,157,165,157,166,157,168,157,169,157,170,157,171,157,172,158,174,158,175,158,176,158,178,158,180,158,181,158,182,159,184,160,185,160,186,161,187,162,188,163,188,164,189,165,189,166,189,167,189,168,189,169,189,170,189,171,189,172,189,174,189,176,189,178,189,180,188,182,187,183,186,184,185,185,184,185,182,185,180,185,178,185,176,185,175,186,173,186,172,186,171,186,169,186,168,186,167,185,166,185,165,184,164,183,164,183,163,183,162,182,160,182,159,181,158,180,157,179,155,178,155,177,154,176,153,175,152,175,151,174,150,173,150,172,150,171,150,169,150,170,150,171,150,172,149,173,149,174,149,177,148,179,147,181,146,183,145,185,144,187,143,191,141,193,140,195,139,197,137,199,136,200,135,201,135,202,134,202,132,202,131,202,129,202,127,202,125,202,123,202,122,201,118,201,117,200,114,198,112,197,110,196,108,193,105,192,104,189,103,188,102,187,102,184,99,183,99,183,98,182,98,181,98,180,98,178,98,177,98,175,98,173,98,171,98,169,98,168,98,167,98,165,98,163,98,161,98,159,98,157,98,156,98,155,98,154,98});
  one.learn("red", new int [] {166,251,166,246,166,240,166,236,167,231,167,225,167,222,167,217,167,215,167,213,167,211,167,210,167,208,167,207,168,205,168,203,169,201,170,198,171,196,172,194,173,192,173,190,173,188,173,187,173,186,173,185,173,184,174,184,175,184,176,183,177,182,178,179,180,177,182,175,186,172,187,170,188,169,189,168,189,167,190,166,191,165,192,165,193,164,196,164,197,164,198,164,199,164,200,164,201,164,202,164,203,164,204,164,205,164,206,164,207,164,208,165,209,166,209,167,212,169,214,170,217,171,219,173,221,174,223,175,224,176,224,177,224,179,224,180,224,182,224,184,224,185,224,188,224,189,224,190,224,192,224,193,224,194,223,195,222,197,222,198,221,199,221,200,220,201,219,201,218,202,217,203,216,204,215,204,213,204,212,206,211,206,210,206,209,207,208,207,208,208,207,209,206,210,203,210,201,212,199,213,197,213,194,214,191,216,189,217,186,218,183,219,181,219,179,220,177,220,175,220,173,220,172,220,171,220,170,220,169,220,168,220,167,220,166,220,165,220,166,220,167,220,168,220,169,220,170,220,171,220,172,220,175,220,177,221,179,223,181,227,185,229,186,231,188,233,190,235,192,239,196,241,197,243,199,245,200,246,201,247,201,248,202,248,203,249,205,250,206,251,207,252,208,253,208,254,209,254,210,256,211,257,212,258,214,259,215,260,216,261,216,262,217,262,218,263,219,265,220,266,221,266,221,267});
  one.learn("green", new int [] {263,123,262,123,261,123,260,123,259,123,258,123,257,123,256,123,255,123,254,123,253,123,252,122,251,122,250,122,249,122,248,122,246,122,244,122,243,122,242,122,241,122,240,122,238,122,237,122,236,122,234,122,233,123,232,123,230,124,228,125,226,126,224,127,223,128,222,129,221,129,220,130,218,131,217,131,217,132,216,133,215,134,214,135,213,136,212,136,211,137,210,139,209,141,209,142,208,143,208,145,208,146,207,148,207,150,207,152,207,153,207,154,207,156,207,158,207,159,207,161,207,163,207,165,207,167,208,169,208,171,208,172,209,173,210,175,210,176,211,177,212,179,213,180,214,181,215,182,216,183,216,184,217,185,217,186,218,188,219,190,220,191,221,191,222,193,223,194,224,195,224,196,225,197,226,198,226,199,229,202,231,203,232,204,233,205,234,205,236,206,237,207,237,208,238,208,239,208,240,208,241,208,242,209,244,209,246,209,247,209,249,209,250,209,252,209,253,209,254,209,255,209,257,208,259,207,261,206,263,205,264,204,266,203,267,202,269,201,270,200,270,199,271,199,272,198,273,197,273,196,274,194,275,192,275,190,275,189,276,187,276,185,276,184,276,183,276,182,276,181,276,180,275,179,274,177,273,176,272,175,272,174,271,174,270,174,269,174,268,173,267,172,266,171,265,170,264,169,263,169,262,168,261,168,260,167,259,166,258,166,257,166,256,166,255,166,254,166,253,166,252,166,250,167,249,167,247,168,246,169,245,171,245,172,244,173,243,174,243,175,243,176,242,177,242,178,241,179,241,180,241,181,241,182,241,183,240,184,240,185,240,186,240,187,240,188});
  one.learn("blue", new int [] {150,131,150,132,150,133,150,134,150,135,150,136,150,137,150,138,150,139,150,141,150,142,149,142,149,143,149,145,149,146,149,147,148,148,148,149,148,151,148,152,147,154,147,155,147,156,147,157,147,158,147,159,147,160,147,162,146,164,146,165,146,166,146,168,145,169,145,171,144,172,144,173,143,174,143,175,143,176,143,177,143,179,143,180,143,181,143,182,143,184,143,185,143,187,143,188,143,189,142,191,142,193,142,195,142,196,142,198,142,199,142,201,142,203,142,204,142,206,142,207,142,209,142,210,142,212,143,214,143,215,144,217,145,219,146,220,147,221,147,222,148,223,149,224,150,225,151,226,152,227,154,228,156,229,157,229,158,230,160,230,161,231,162,232,163,232,164,232,165,232,167,232,168,232,169,232,170,232,172,232,173,232,174,232,176,232,177,232,178,231,179,229,180,229,180,227,180,225,180,223,180,221,180,219,180,216,180,214,180,213,180,211,180,209,180,207,180,204,180,202,180,201,180,200,179,198,178,197,177,196,177,195,176,194,175,191,174,190,173,190,172,189,171,188,170,188,170,187,169,186,168,186,167,185,166,184,164,184,163,183,163,182,162,181,159,179,158,179,157,177,156,176,155,175,154,175,154,174,153,174,152,173,151,172,150,171,149,170,148,169,147,169,148,169,150,169,151,170,152,171,154,172,156,173,158,174,159,175,161,176,163,177,165,178,166,178,166,179,167,180,169,180,170,180,171,181,172,181,173,181,174,181,175,182,176,182,178,183,179,183,180,183,180,184,181,184,182,184,184,184,185,184,186,184,187,184,188,184,189,184,190,184,191,184,193,184,194,184,195,184,196,184,198,184,200,184,201,184,201,183,202,182,203,182,204,181,205,180,206,179,207,178,207,177});
  one.learn("thin", new int [] {141,179,143,179,144,178,146,177,147,177,148,176,150,174,150,173,151,172,152,171,153,170,155,169,157,168,159,167,161,165,162,164,164,163,165,163,167,161,169,160,171,159,173,158,174,157,175,155,178,154,180,152,181,151,181,150,182,149,183,148,184,147,185,147,186,147,187,147,188,147,188,148,188,149,188,150,188,152,188,154,188,155,189,158,189,159,189,163,190,165,190,168,190,171,190,174,190,176,190,178,190,180,190,182,190,184,190,186,190,189,190,191,191,193,191,195,191,197,191,199,191,201,191,203,191,205,191,206,191,207,191,209,191,211,191,213,191,215,191,217,191,218,191,220,191,222,191,223,191,224,191,226,191,227,191,228,191,229,191,230,191,231,191,232,191,233,191,234,191,235,191,236,191,237,191,238,191,239,191,240,191,241,191,243,191,244,189,244,188,244,187,244,185,244,183,244,182,244,181,244,179,244,177,244,175,244,174,244,172,244,170,244,168,244,166,244,164,244,163,244,162,244,161,243,160,243,159,243,157,243,156,243,154,243,152,243,151,243,149,242,148,242,147,241,146,241,147,241,148,241,149,241,150,241,152,241,154,241,155,241,157,240,159,240,161,240,163,240,165,240,168,240,171,240,173,240,175,240,178,239,180,238,182,238,184,238,185,238,187,238,189,238,191,238,192,238,193,238,195,238,197,238,198,238,200,237,201,237,203,237,204,237,205,237,206,237,208,236,210,235,211,235,213,235,215,235,216,235,218,235,220,235,221,235,222,235});
  one.learn("medium", new int[] {118,127,119,127,120,127,121,127,123,127,124,127,125,127,126,127,128,127,129,127,130,127,131,127,132,127,133,127,134,127,135,127,136,127,137,127,139,127,141,127,143,127,144,127,146,127,147,127,148,127,149,127,150,127,152,127,153,127,155,127,157,127,158,127,160,127,162,128,164,129,166,129,168,129,169,129,170,129,170,130,171,131,172,131,172,132,172,133,172,134,172,136,172,138,172,139,172,140,172,142,172,143,172,145,172,146,172,148,172,150,172,152,172,153,172,155,172,156,172,157,172,158,172,159,172,160,172,161,172,162,172,164,172,165,172,166,172,167,172,169,172,170,172,171,172,172,171,172,168,172,164,172,161,172,158,172,156,172,154,172,153,172,152,172,151,172,147,172,145,172,144,172,140,171,139,171,136,171,134,171,132,170,131,170,130,169,129,169,128,169,127,169,125,169,124,169,123,169,122,169,121,169,120,168,119,168,118,168,117,168,117,169,117,170,117,171,116,173,116,174,116,175,116,177,116,178,116,180,116,181,116,183,116,184,116,185,116,186,116,188,116,190,116,191,116,192,116,193,116,194,116,195,116,196,116,198,116,199,116,200,116,202,116,203,116,205,116,206,116,207,116,208,116,209,116,210,116,211,116,212,117,212,118,213,119,213,120,213,121,213,122,214,123,214,125,214,126,214,128,214,130,214,132,214,133,214,134,214,135,214,137,214,138,214,140,214,141,214,143,214,144,214,146,214,147,214,148,214,149,214,151,214,152,214,154,214,155,214,156,214,157,214,158,214,159,214,160,214,161,214});
  one.learn("thick", new int[] {138,113,138,112,139,111,140,110,141,109,142,108,143,107,144,106,145,105,146,105,147,105,148,104,149,104,150,103,151,103,152,103,154,102,156,102,158,102,159,101,160,101,161,101,163,101,164,101,165,101,166,101,167,101,168,101,169,101,170,101,171,101,172,101,173,101,174,101,175,101,176,102,177,103,177,104,178,105,179,106,180,107,181,107,182,108,183,109,183,110,183,111,184,112,184,113,185,113,185,114,186,115,187,117,188,118,188,119,188,120,188,121,188,122,188,123,188,124,188,125,188,126,188,128,188,129,188,130,188,131,188,132,188,133,188,134,188,135,188,136,188,137,188,138,188,139,188,140,187,142,186,143,185,144,183,145,183,146,182,147,181,147,179,148,178,148,177,148,175,149,174,149,173,149,172,149,170,150,169,150,168,150,167,150,166,151,164,152,162,152,160,152,159,152,158,152,157,152,155,153,154,153,153,153,152,153,151,154,150,154,149,155,147,155,145,155,144,155,143,155,142,155,141,155,142,155,143,155,145,155,147,155,149,155,150,155,152,155,154,155,156,155,158,155,160,155,162,155,165,155,167,155,169,156,171,156,172,156,173,156,175,156,175,157,176,157,177,157,179,157,180,157,181,157,182,158,183,158,185,158,186,158,187,159,188,159,190,160,191,160,192,160,193,160,194,161,195,161,195,162,196,163,198,164,199,165,200,165,202,166,203,168,204,169,204,170,204,171,205,172,205,173,205,174,205,175,205,177,205,178,205,179,205,180,205,181,205,182,205,183,205,184,205,185,205,186,205,187,205,188,205,190,205,191,205,193,205,195,204,196,204,197,203,198,202,200,202,201,201,202,200,203,199,204,198,204,197,206,197,207,195,209,193,210,190,212,188,213,186,214,185,215,185,216,183,217,182,218,181,219,180,219,179,219,178,220,177,220,175,220,174,221,172,221,171,221,170,222,169,222,167,222,166,222,164,222,163,222,161,222,159,222,157,222,156,222,155,222,153,222,152,222,151,222,150,222,149,222,147,222,146,222,145,222,144,222,143,222,142,222,141,222,140,222,139,222,139,221,138,221,136,220});
  
  // Bind templates to methods (callbacks):
  one.bind("rectangle circle freeform_line straight_line black red green blue thin medium thick", "detected");
}


//TODO 
// get freeform lines to work.

void draw() {
  background(255);
  
  if (mouseButton == RIGHT) {
    one.draw();
  }

  for (int i = 0; i < shapes.size(); i++) {
    fill(shapes.get(i)[6], shapes.get(i)[7], shapes.get(i)[8]);
    stroke(shapes.get(i)[6]-100, shapes.get(i)[7]-100, shapes.get(i)[8]-100);
    strokeWeight(shapes.get(i)[5]);

    if(shapes.get(i)[0] == 1) {
      rect(shapes.get(i)[1], shapes.get(i)[2], shapes.get(i)[3], shapes.get(i)[4]);
    } else if (shapes.get(i)[0] == 2) {
      ellipseMode(CORNER);
      ellipse(shapes.get(i)[1], shapes.get(i)[2], shapes.get(i)[3], shapes.get(i)[4]);
    } else if (shapes.get(i)[0] == 3) {
      line(shapes.get(i)[1], shapes.get(i)[2], shapes.get(i)[3], shapes.get(i)[4]);
    }
    else if (shapes.get(i)[0] == 4)
    {
      shape(freeShapes.get(shapes.get(i)[9]));
    }
  }
   
  if (dragX != 0 || dragY != 0) {
    fill(red, green, blue);
    stroke(red-100, green-100, blue-100);
    strokeWeight(strokeWeight);
    
    if (shapeID == 1) {
      rect(moveX, moveY, dragX - moveX, dragY - moveY);
    } else if (shapeID == 2) {
      ellipseMode(CORNER);
      ellipse(moveX, moveY, dragX - moveX, dragY - moveY);
    } else if (shapeID == 3) {
      line(moveX, moveY, dragX, dragY);
    } if (shapeID == 4) {
      free.stroke(red, green, blue);
      free.noFill();
      free.vertex(mouseX, mouseY);
      shape(free);
    }
  }
  fill(0, 102, 153);
  text("Shape: " + shapeID, width - 250, 30); 
  text("Colour: "+ red + ", " + green + ", " + blue, width - 250, 60);
  text("Weight: " + strokeWeight, width - 250, 90); 
}

void keyPressed() {
  if (key == 'r') {
    shapeID = 1;
  } else if (key == 'o') {
    shapeID = 2;
  } else if (key == 'l') {
    shapeID = 3;
  } else if (key == 'f') {
    shapeID = 4;
    free = createShape();
    free.beginShape();
    free.noFill();
  }
  
  if (key == '1') {
    strokeWeight = 1;
  } else if (key == '2') {
    strokeWeight = 5;
  } else if (key == '3') {
    strokeWeight = 10;
  }
  
  if (key == '!') {
    // Black
    red = 0;
    green = 0;
    blue = 0;
  } else if (key == '@') {
    // Red
    red = 255;
    green = 0;
    blue = 0;
  } else if (key == '#') {
    // Green
    red = 0;
    green = 255;
    blue = 0;
  } else if (key == '$') {
    // Blue
    red = 0;
    green = 0;
    blue = 255;
  }
  
  if (key == BACKSPACE && shapes.size() >= 1) {
    if(shapes.get(shapes.size() - 1)[0] == 4)
    {
      freeShapes.remove(freeShapes.size() - 1);
    }
    shapes.remove(shapes.size() - 1);
  }
}

void detected(String gesture, float percent, int startX, int startY, int centroidX, int centroidY, int endX, int endY) {
    if (gesture == "rectangle") {
    shapeID = 1;
  } else if (gesture == "oval") {
    shapeID = 2;
  } else if (gesture == "straight_line") {
    shapeID = 3;
  } else if (gesture == "freeform_line") {
    shapeID = 4;
    free = createShape();
    free.beginShape();
  }
  
  if (gesture == "thin") {
    strokeWeight = 1;
  } else if (gesture == "medium") {
    strokeWeight = 5;
  } else if (gesture == "thick") {
    strokeWeight = 10;
  }
  
  if (gesture == "black") {
    // Black
    red = 0;
    green = 0;
    blue = 0;
  } else if (gesture == "red") {
    // Red
    red = 255;
    green = 0;
    blue = 0;
  } else if (gesture == "green") {
    // Green
    red = 0;
    green = 255;
    blue = 0;
  } else if (gesture == "blue") {
    // Blue
    red = 0;
    green = 0;
    blue = 255;
  }
}

void mousePressed() {
  if (shapeID != 0 && mouseButton == LEFT) {
    moveX = mouseX;
    moveY = mouseY;
  }
}

void mouseDragged() {
  if (shapeID != 0 && mouseButton == LEFT) {
    dragX = mouseX;
    dragY = mouseY;
  }  else if (mouseButton == RIGHT) {
    // Guesture recognition
    one.track(mouseX, mouseY);
  }
}

void mouseReleased() {
  if (mouseButton == LEFT) {
    // To deal with the diffrent format of second point co-cords for a line
    int secondPointX, secondPointY;
    if (shapeID == 3) {
      secondPointX = dragX;
      secondPointY = dragY;
    } else {
      secondPointX = dragX - moveX;
      secondPointY = dragY - moveY;
    }
    if(shapeID == 4)
    {
      free.endShape();
      free.setStrokeWeight(strokeWeight);
      shapes.add(new int[] {shapeID, moveX, moveY, secondPointX, secondPointY, strokeWeight, red, green, blue, freeShapes.size()});
      freeShapes.add(free);
      free = createShape();
      free.beginShape();
    }
    else
    {
      int[] shape = {shapeID, moveX, moveY, secondPointX, secondPointY, strokeWeight, red, green, blue};
      shapes.add(shape);
    }
    
    dragX = 0;
    dragY = 0;
    moveX = 0;
    moveY = 0;
  }
}
